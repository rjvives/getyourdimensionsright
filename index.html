<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Measure Mapper · MVP v3</title>
  <style>
    :root { --bg:#0b1020; --card:#121a36; --ink:#e6edf7; --muted:#93a4c6; --accent:#6ee7ff; }
    * { box-sizing: border-box; }
    body { margin: 0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial; background: linear-gradient(180deg,#0b1020,#0d1630); color: var(--ink); }
    .wrap { max-width: 980px; margin: 0 auto; padding: 32px 20px 80px; }
    h1 { font-size: clamp(28px, 4vw, 44px); margin: 0 0 8px; letter-spacing: -0.02em; }
    p.lead { color: var(--muted); margin: 0 0 28px; }

    .card { background: linear-gradient(180deg,#111a34,#0e1730); border: 1px solid #1f2a4a; border-radius: 16px; padding: 18px; box-shadow: 0 10px 30px rgba(0,0,0,.25); }
    .row { display:flex; gap:10px; align-items: center; }
    .row > * { flex: 1; }
    label { display: block; font-size: 12px; color: var(--muted); margin-bottom: 6px; }
    select { width: 100%; padding: 12px 14px; border-radius: 12px; border: 1px solid #2a375f; background: #0c1530; color: var(--ink); outline: none; }
    select:focus { border-color: var(--accent); box-shadow: 0 0 0 3px rgba(110,231,255,.15); }

    .slider-row { display:flex; align-items:center; gap:14px; }
    input[type="range"] { flex: 1; appearance: none; height: 6px; background: #1a2546; border-radius: 999px; outline: none; }
    input[type="range"]::-webkit-slider-thumb { -webkit-appearance: none; appearance: none; width: 18px; height: 18px; border-radius: 50%; background: var(--accent); border: 2px solid #0a132b; box-shadow: 0 2px 6px rgba(0,0,0,.35); }
    input[type="range"]::-moz-range-thumb { width: 18px; height: 18px; border-radius: 50%; background: var(--accent); border: 2px solid #0a132b; }

    .value-pill { min-width: 120px; text-align: right; font-variant-numeric: tabular-nums; }
    .value-pill b { font-size: 18px; }
    .muted { color: var(--muted); }

    .result { margin-top: 14px; font-size: 14px; line-height: 1.5; }
    .small { font-size: 12px; }
    .hr { height: 1px; background: #1f2a4a; margin: 16px 0; border: 0; }
  </style>
</head>
<body>
  <div class="wrap">
    <h1>Measure Mapper <span class="small muted">MVP v3</span></h1>
    <p class="lead">Now the slider <b>auto-scales based on real-world ranges</b>. Switch type and unit to see context-appropriate ranges.</p>

    <!-- CONTROLS: TYPE & UNIT -->
    <section class="card" style="margin-bottom:16px;">
      <div class="row">
        <div>
          <label>Measurement type</label>
          <select id="typeSelect">
            <option value="area" selected>Area</option>
            <option value="flow">Flow / Discharge</option>
            <option value="length">Length / Distance</option>
          </select>
        </div>
        <div>
          <label>Unit</label>
          <select id="unitSelect"></select>
        </div>
      </div>
      <div class="hr"></div>
      <div>
        <label class="muted">Value</label>
        <div class="slider-row">
          <input id="valueSlider" type="range" min="0" max="100" step="1" value="30" />
          <div class="value-pill"><b id="valueReadout">30</b> <span id="unitReadout">km²</span></div>
        </div>
      </div>
    </section>

    <!-- RESULTS -->
    <section class="card">
      <div id="resultHeading" class="small muted" style="margin-bottom:8px;">Comparisons</div>
      <div id="resultBox" class="result"></div>
      <div id="examplesNote" class="small muted" style="margin-top:10px;"></div>
    </section>
  </div>

  <script>
    const K = {
      KM2: 1_000_000,
      MI2_TO_M2: 2_589_988.110336,
      HECTARE: 10_000,
      KM: 1_000,
      MI_TO_M: 1609.344,
      L_TO_M3: 1/1000,
      FT3_TO_M3: 0.028316846592,
    };

    const comparisons = {
      area: [
        { id:"soccer_pitch", label:"soccer pitches", area_m2: 105*68, note:"FIFA ~105×68 m" },
        { id:"central_park", label:"Central Parks (NYC)", area_m2: 3.41*K.KM2 },
        { id:"cologne_oldtown", label:"Cologne Old Towns", area_m2: 1.5*K.KM2, approx:true },
      ],
      flow: [
        { id:"bathtub", label:"bathtubs / s", volume_m3: 0.150 },
        { id:"olympic_pool", label:"Olympic pools / min", volume_m3: 2500, timeScale:"min" },
        { id:"garden_hose", label:"garden hoses / s", volume_m3: 15*K.L_TO_M3/60, note:"~15 L/min" },
      ],
      length: [
        { id:"marathon", label:"marathons", length_m: 42195 },
        { id:"cologne_cathedral", label:"Cologne Cathedral heights", length_m: 157 },
        { id:"city_block", label:"city blocks", length_m: 100, approx:true },
      ]
    };

    // Typical ranges for auto-scaling sliders
    const unitCfg = {
      area: {
        units: [
          { id:'km2', label:'km²', toM2:v=>v*K.KM2, fromM2:v=>v/K.KM2, typical:[0,5000] }, // up to region size
          { id:'ha', label:'hectares', toM2:v=>v*K.HECTARE, fromM2:v=>v/K.HECTARE, typical:[0,200000] },
          { id:'m2', label:'m²', toM2:v=>v, fromM2:v=>v, typical:[0,10_000_000] },
          { id:'mi2', label:'mi²', toM2:v=>v*K.MI2_TO_M2, fromM2:v=>v/K.MI2_TO_M2, typical:[0,2000] },
        ],
        examples:"Soccer pitch ~0.007 km², Central Park ~3.41 km²",
      },
      flow: {
        units: [
          { id:'m3s', label:'m³/s', toM3s:v=>v, fromM3s:v=>v, typical:[0,20000] }, // large rivers like Amazon ~200,000 m³/s
          { id:'ls', label:'L/s', toM3s:v=>v*K.L_TO_M3, fromM3s:v=>v/K.L_TO_M3, typical:[0,2_000_000] },
          { id:'ft3s', label:'ft³/s', toM3s:v=>v*K.FT3_TO_M3, fromM3s:v=>v/K.FT3_TO_M3, typical:[0,700000] },
        ],
        examples:"Bathtub ~150 L, Garden hose ~15 L/min, Olympic pool ~2,500 m³",
      },
      length: {
        units: [
          { id:'km', label:'km', toM:v=>v*K.KM, fromM:v=>v/K.KM, typical:[0,20000] }, // Earth scale
          { id:'m', label:'m', toM:v=>v, fromM:v=>v, typical:[0,2_000_000] },
          { id:'mi', label:'miles', toM:v=>v*K.MI_TO_M, fromM:v=>v/K.MI_TO_M, typical:[0,12000] },
        ],
        examples:"Marathon 42.195 km, Cologne Cathedral 157 m",
      }
    };

    let state = { type: 'area', unit: 'km2', value: 30 };

    const fmt = (n) => new Intl.NumberFormat(undefined, { maximumFractionDigits: 2 }).format(n);

    function populateUnits(){
      const uSel = document.getElementById('unitSelect');
      uSel.innerHTML = '';
      for(const u of unitCfg[state.type].units){
        const opt = document.createElement('option');
        opt.value = u.id; opt.textContent = u.label; if(u.id === state.unit) opt.selected = true;
        uSel.appendChild(opt);
      }
    }

    function applySliderPreset(){
      const cfg = unitCfg[state.type].units.find(u=>u.id===state.unit);
      const slider = document.getElementById('valueSlider');
      const [min,max] = cfg.typical;
      slider.min = min; slider.max = max; slider.step = (max-min)/200; // ~200 steps
      if(state.value < min || state.value > max){ state.value = (min+max)/20; }
      slider.value = state.value;
      document.getElementById('valueReadout').textContent = fmt(state.value);
      document.getElementById('unitReadout').textContent = cfg.label;
    }

    function render(){
      // Compute base values and render comparisons
      const res = [];
      const cfgUnit = unitCfg[state.type].units.find(u=>u.id===state.unit);

      if(state.type === 'area'){
        const m2 = cfgUnit.toBase(state.value);
        for(const c of comparisons.area){
          const n = m2 / c.area_m2; res.push(`≈ <b>${fmt(n)}</b> ${c.label}${c.approx? ' <span class=\"small muted\">(approx)</span>':''}${c.note? ` <span class=\"small muted\">— ${c.note}</span>`:''}`);
        }
      }
      if(state.type === 'flow'){
        const m3s = cfgUnit.toBase(state.value);
        for(const c of comparisons.flow){
          if(c.timeScale === 'min'){
            const perMin = m3s*60 / c.volume_m3; res.push(`≈ <b>${fmt(perMin)}</b> ${c.label}`);
          } else {
            const perSec = m3s / c.volume_m3; res.push(`≈ <b>${fmt(perSec)}</b> ${c.label}${c.note? ` <span class=\"small muted\">— ${c.note}</span>`:''}`);
          }
        }
      }
      if(state.type === 'length'){
        const m = cfgUnit.toBase(state.value);
        for(const c of comparisons.length){
          const n = m / c.length_m; res.push(`≈ <b>${fmt(n)}</b> ${c.label}${c.approx? ' <span class=\"small muted\">(approx)</span>':''}`);
        }
      }

      document.getElementById('resultBox').innerHTML = res.map(r=>`<div>${r}</div>`).join('');
      document.getElementById('examplesNote').textContent = unitCfg[state.type].examples;
      document.getElementById('resultHeading').textContent = `Comparisons for ${state.type} at ${fmt(state.value)} ${document.getElementById('unitReadout').textContent}`;
    }</b> ${c.label}${c.approx? ' <span class=\"small muted\">(approx)</span>':''}${c.note? ` <span class=\"small muted\">— ${c.note}</span>`:''}`);
        }
      }
      if(state.type === 'flow'){
        const toM3s = unitCfg.flow.units.find(u=>u.id===state.unit).toM3s;
        const m3s = toM3s(state.value);
        for(const c of comparisons.flow){
          if(c.timeScale === 'min'){
            const perMin = m3s*60 / c.volume_m3; res.push(`≈ <b>${fmt(perMin)}</b> ${c.label}`);
          } else {
            const perSec = m3s / c.volume_m3; res.push(`≈ <b>${fmt(perSec)}</b> ${c.label}${c.note? ` <span class=\"small muted\">— ${c.note}</span>`:''}`);
          }
        }
      }
      if(state.type === 'length'){
        const toM = unitCfg.length.units.find(u=>u.id===state.unit).toM;
        const m = toM(state.value);
        for(const c of comparisons.length){
          const n = m / c.length_m; res.push(`≈ <b>${fmt(n)}</b> ${c.label}${c.approx? ' <span class=\"small muted\">(approx)</span>':''}`);
        }
      }

      document.getElementById('resultBox').innerHTML = res.map(r=>`<div>${r}</div>`).join('');
      document.getElementById('examplesNote').textContent = unitCfg[state.type].examples;
      document.getElementById('resultHeading').textContent = `Comparisons for ${state.type} at ${fmt(state.value)} ${document.getElementById('unitReadout').textContent}`;
    }

    const typeSelect = document.getElementById('typeSelect');
    const unitSelect = document.getElementById('unitSelect');
    const slider = document.getElementById('valueSlider');

    typeSelect.addEventListener('change', () => {
      state.type = typeSelect.value;
      state.unit = unitCfg[state.type].units[0].id;
      state.value = null;
      populateUnits();
      applySliderPreset();
      render();
    });

    unitSelect.addEventListener('change', () => {
      state.unit = unitSelect.value;
      state.value = null;
      applySliderPreset();
      render();
    });

    slider.addEventListener('input', () => {
      state.value = parseFloat(slider.value);
      document.getElementById('valueReadout').textContent = fmt(state.value);
      render();
    });

    populateUnits();
    applySliderPreset();
    render();
  </script>
</body>
</html>
